# MoeChat 配置项说明文档

本文档详细说明了 MoeChat 系统中 `config.yaml` 文件的各项配置参数。

## 目录
- [Core 核心配置](#core-核心配置)
- [ASR 语音识别配置](#asr-语音识别配置)
- [LLM 大语言模型配置](#llm-大语言模型配置)
- [GSV 语音合成配置](#gsv-语音合成配置)
- [Agent 智能体配置](#agent-智能体配置)
- [外部功能配置](#外部功能配置)

---

## Core 核心配置

### `Core.tt`
- **类型**: Boolean
- **默认值**: `false`
- **说明**: 核心功能开关，控制某些核心特性的启用状态

### `Core.sv`
声音验证相关配置

#### `Core.sv.is_up`
- **类型**: Boolean
- **默认值**: `false`
- **说明**: 是否启用声音验证功能

#### `Core.sv.master_audio`
- **类型**: String
- **默认值**: `"test.wav"`
- **说明**: 包含用户声音的wav音频文件路径，建议时长3-5秒

#### `Core.sv.thr`
- **类型**: Number
- **说明**: 声音识别阈值，数值越小越敏感，建议范围0.5-0.8

---

## ASR 语音识别配置

### `ASR.use_remote`
- **类型**: Boolean
- **默认值**: `false`
- **说明**: 是否使用远程ASR服务，设为true时使用远程API，false时使用本地模型

### `ASR.remote_api`
- **类型**: String
- **默认值**: `""`
- **说明**: 远程ASR API的服务地址

### `ASR.api_key`
- **类型**: String
- **默认值**: `""`
- **说明**: 远程ASR API的访问密钥

### `ASR.model`
- **类型**: String
- **默认值**: `""`
- **说明**: 远程ASR服务使用的模型名称

### `ASR.language`
- **类型**: String
- **默认值**: `"zh"`
- **说明**: 语音识别的语言设置，zh为中文，en为英文

### `ASR.local_model_path`
- **类型**: String
- **默认值**: `"./utilss/models/SenseVoiceSmall"`
- **说明**: 本地ASR模型的存储路径

### `ASR.device`
- **类型**: String
- **默认值**: `"cuda:0"`
- **说明**: 运行设备设置，cuda:0表示使用第一块GPU，cpu表示使用CPU

---

## LLM 大语言模型配置

### `LLM.api`
- **类型**: String
- **默认值**: `"http://27.159.93.61:7866/v1/chat/completions"`
- **说明**: 大语言模型API的服务地址，需要兼容OpenAI格式

### `LLM.key`
- **类型**: String
- **默认值**: `"1"`
- **说明**: 大语言模型API的访问密钥

### `LLM.model`
- **类型**: String
- **默认值**: `"Qwen3-30B-A3B-Instruct-2507-FP8"`
- **说明**: 使用的大语言模型名称

### `LLM.extra_config`
- **类型**: Object
- **说明**: 大模型API的额外参数配置，如temperature（温度参数）等

---

## GSV 语音合成配置

### `GSV.api`
- **类型**: String
- **默认值**: `""`
- **说明**: 语音合成API地址

### `GSV.text_lang`
- **类型**: String
- **默认值**: `"zh"`
- **说明**: 文本语言设置

### `GSV.GPT_weight`
- **类型**: String
- **默认值**: `""`
- **说明**: GPT模型权重文件路径

### `GSV.SoVITS_weight`
- **类型**: String
- **默认值**: `""`
- **说明**: SoVITS模型权重文件路径

### `GSV.ref_audio_path`
- **类型**: String
- **默认值**: `""`
- **说明**: 参考音频文件路径

### `GSV.prompt_text`
- **类型**: String
- **默认值**: `""`
- **说明**: 提示文本内容

### `GSV.prompt_lang`
- **类型**: String
- **默认值**: `"zh"`
- **说明**: 提示文本语言

### `GSV.aux_ref_audio_paths`
- **类型**: Array
- **说明**: 多参考音频路径列表，仅v2模型有效

### `GSV.seed`
- **类型**: Number
- **默认值**: `-1`
- **说明**: 随机种子，-1表示随机

### `GSV.top_k`
- **类型**: Number
- **默认值**: `15`
- **说明**: Top-K采样参数

### `GSV.batch_size`
- **类型**: Number
- **默认值**: `20`
- **说明**: 批处理大小

### `GSV.ex_config.text_split_method`
- **类型**: String
- **默认值**: `"cut0"`
- **说明**: 文本分割方法

### `extra_ref_audio`
- **类型**: Object
- **说明**: 使用情绪标签选择参考音频的配置，格式为情绪标签对应音频路径和文本

---

## Agent 智能体配置

### `Agent.is_up`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用角色模板功能，false时仅提供常规语音对话功能

### `Agent.char`
- **类型**: String
- **默认值**: `"Chat酱"`
- **说明**: 角色名称，会写入到提示词中

### `Agent.user`
- **类型**: String
- **默认值**: `"芙兰蠢兔"`
- **说明**: 用户名称，会写入到提示词中

### `Agent.long_memory`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用日记功能，可长期储存对话信息并根据时间检索

### `Agent.is_check_memorys`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 启用日记检索加强，使用嵌入模型提取相关信息

### `Agent.is_core_mem`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用核心记忆功能，储存用户重要信息如住址、爱好等

### `Agent.mem_thresholds`
- **类型**: Number
- **默认值**: `0.38`
- **说明**: 日记内容搜索阈值，用于判断匹配程度，范围0-1

### `Agent.lore_books`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用世界书（知识库）功能

### `Agent.books_thresholds`
- **类型**: Number
- **默认值**: `0.5`
- **说明**: 知识库检索阈值，范围0-1

### `Agent.scan_depth`
- **类型**: Number
- **默认值**: `4`
- **说明**: 知识库搜索深度，返回知识的数量

### `Agent.mood_system_enabled`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用情绪系统，false可完全禁用

### `Agent.mood_persists`
- **类型**: Boolean
- **默认值**: `false`
- **说明**: 情绪值是否持久化，true时重启后读取上次情绪值

### `Agent.mood_functions`
情绪影响函数配置

#### `Agent.mood_functions.positive_impact`
- **类型**: String
- **默认值**: `"1 + log(3 * pi * x) + 0.8 * sqrt(x)"`
- **说明**: 正面情绪影响函数

#### `Agent.mood_functions.negative_impact`
- **类型**: String
- **默认值**: `"(sqrt(pi) * x) / (1 + exp(sqrt(e) * 0.8 * (sqrt(pi) - x))) + sqrt(e)"`
- **说明**: 负面情绪影响函数

### `Agent.context_length`
- **类型**: Number
- **默认值**: `0`
- **说明**: 上下文长度，决定保存多少条上下文，0表示保存所有

### `Agent.char_settings`
- **类型**: String
- **说明**: 角色基本设定，会组合到角色设定提示词中，支持{{user}}、{{char}}占位符

### `Agent.char_personalities`
- **类型**: String
- **说明**: 角色性格设定，会组合到角色性格提示词中，支持{{user}}、{{char}}占位符

### `Agent.mask`
- **类型**: String
- **默认值**: `""`
- **说明**: 用户自身设定，可填入性格喜好或与角色的关系

### `Agent.message_example`
- **类型**: String
- **说明**: 对话示例，用于强化AI的文风

### `Agent.prompt`
- **类型**: String
- **说明**: 自定义提示词，不基于模板的完全自定义提示词

### `Agent.start_with`
- **类型**: Array
- **说明**: 开场白数组，用于创建开场对话内容

---

## 外部功能配置

### 天气查询功能

#### `HeWeather.Is_on`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用天气查询功能，启用后用户可询问天气相关问题

### 网络图片搜索功能

#### `get_image.enabled`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用网络图片搜索功能，AI可根据用户需求搜索网络图片

### 表情包功能

#### `Memes.turn_on`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用表情包功能，AI可根据情绪发送表情包
- **注意**: 需要在`web/static/memes/`目录下添加表情包文件夹

### 本地图片分享功能

#### `Pics.turn_on`
- **类型**: Boolean
- **默认值**: `true`
- **说明**: 是否启用本地图片分享功能，AI可分享本地精美图片
- **注意**: 需要在相应目录下添加图片文件

---

## 配置建议

1. **首次使用**: 建议先使用默认配置，确保系统正常运行后再进行个性化调整
2. **性能优化**: 如果硬件配置较低，可以将`ASR.device`设置为`"cpu"`
3. **记忆功能**: 阈值设置过高可能丢失数据，过低则过滤效果差，建议根据实际使用效果调整
4. **情绪系统**: 如不需要情绪功能，可设置`mood_system_enabled: false`提升性能
5. **外部功能**: 根据需要启用相应功能，未使用的功能建议关闭以节省资源

## 故障排除

- **API连接失败**: 检查`LLM.api`地址是否正确，网络是否畅通
- **模型加载失败**: 检查模型路径是否正确，模型文件是否完整
- **功能异常**: 检查相关配置项是否正确设置，依赖文件是否存在

---

*本文档基于当前版本的配置文件生成，如有更新请及时同步修改。*